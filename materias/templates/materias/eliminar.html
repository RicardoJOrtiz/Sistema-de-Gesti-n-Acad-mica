{% extends 'base.html' %}
{% load static %}

{% block title %}Eliminar Materia{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0"><i class="fas fa-trash"></i> Confirmar Eliminación</h5>
        </div>

        <div class="card-body">
          <div class="alert alert-danger">
            <i class="fas fa-exclamation-triangle fa-2x float-start me-3"></i>
            <h6 class="alert-heading">¿Estás seguro?</h6>
            <p class="mb-0">
              Estás a punto de eliminar permanentemente la materia
              <strong>"{{ materia.nombre }}"</strong>. Esta acción no se puede
              deshacer.
            </p>
          </div>

          <!-- Información de la materia a eliminar -->
          <div class="card bg-light">
            <div class="card-body">
              <h6>
                <i class="fas fa-info-circle"></i> Información de la Materia
              </h6>
              <div class="row">
                <div class="col-md-4">
                  <dl class="row mb-0">
                    <dt class="col-sm-5">Código:</dt>
                    <dd class="col-sm-7"><code>{{ materia.codigo }}</code></dd>

                    <dt class="col-sm-5">Nombre:</dt>
                    <dd class="col-sm-7">{{ materia.nombre }}</dd>

                    <dt class="col-sm-5">Carrera:</dt>
                    <dd class="col-sm-7">{{ materia.carrera.nombre }}</dd>
                  </dl>
                </div>
                <div class="col-md-4">
                  <dl class="row mb-0">
                    <dt class="col-sm-12">Año/Cuatrimestre:</dt>
                    <dd class="col-sm-12">
                      {{ materia.anio_cursado }}° Año / {{ materia.get_cuatrimestre_display_short }}
                    </dd>

                    <dt class="col-sm-12">Carga Horaria:</dt>
                    <dd class="col-sm-12">{{ materia.carga_horaria }} horas</dd>
                  </dl>
                </div>
                <div class="col-md-4">
                  <dl class="row mb-0">
                    <dt class="col-sm-12">Cupo Máximo:</dt>
                    <dd class="col-sm-12">{{ materia.cupo_maximo }} alumnos</dd>

                    <dt class="col-sm-12">Creada:</dt>
                    <dd class="col-sm-12">
                      {{ materia.fecha_creacion|date:"d/m/Y" }}
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <!-- Verificaciones antes de eliminar -->
          {% if not materia.puede_eliminarse %}
          <div class="alert alert-warning mt-3">
            <i class="fas fa-lock"></i>
            <strong>No se puede eliminar esta materia</strong>
            <p class="mb-0">
              La materia tiene <strong>{{ materia.get_inscriptos_count }}</strong> alumno{{ materia.get_inscriptos_count|pluralize:"s" }} inscripto{{ materia.get_inscriptos_count|pluralize:"s" }} activo{{ materia.get_inscriptos_count|pluralize:"s" }}. Para poder eliminarla, primero debes dar de baja todas las inscripciones.
            </p>
          </div>
          {% else %}
          <div class="alert alert-info mt-3">
            <i class="fas fa-check-circle"></i>
            <strong>Verificaciones completadas</strong>
            <ul class="mb-0">
              <li>✓ No tiene inscripciones activas</li>
              <li>✓ Se puede eliminar de forma segura</li>
            </ul>
          </div>
          {% endif %}
        </div>

        <div class="card-footer">
          <div class="d-flex justify-content-between">
            <a href="{% url 'materias:detalle' materia.pk %}" class="btn btn-secondary">
              <i class="fas fa-arrow-left"></i> Cancelar
            </a>

            {% if materia.puede_eliminarse %}
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#modalEliminarMateria">
              <i class="fas fa-trash"></i> Eliminar Materia
            </button>
            {% else %}
            <button class="btn btn-danger" disabled>
              <i class="fas fa-lock"></i> No se puede eliminar
            </button>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Información adicional sobre la eliminación -->
      <div class="card mt-3">
        <div class="card-header">
          <h6>
            <i class="fas fa-info-circle"></i> Información sobre la eliminación
          </h6>
        </div>
        <div class="card-body">
          <h6>¿Qué sucede al eliminar una materia?</h6>
          <ul class="mb-3">
            <li>Se elimina permanentemente el registro de la materia</li>
            <li>Se pierden todos los datos asociados</li>
            <li>No se puede recuperar la información una vez eliminada</li>
          </ul>

          <h6>Alternativas a la eliminación:</h6>
          <ul class="mb-0">
            <li>
              <strong>Desactivar:</strong> Marca la materia como inactiva para
              ocultar sin eliminar
            </li>
            <li>
              <strong>Archivar:</strong> Mantén los datos históricos pero sin
              permitir nuevas inscripciones
            </li>
            <li>
              <strong>Transferir inscripciones:</strong> Mueve los alumnos a
              otra materia antes de eliminar
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmación de eliminación -->
<div class="modal fade" id="modalEliminarMateria" tabindex="-1" aria-labelledby="modalEliminarMateriaLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-danger text-white border-0">
        <h5 class="modal-title" id="modalEliminarMateriaLabel">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <span class="d-none d-sm-inline">Confirmar Eliminación</span>
          <span class="d-inline d-sm-none">Eliminar</span>
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body px-3 px-sm-4">
        <div class="text-center mb-3">
          <i class="fas fa-trash-alt text-danger" style="font-size: 2.5rem;"></i>
        </div>
        <p class="text-center fs-6 fs-sm-5 mb-3">
          ¿Estás seguro de que deseas eliminar la materia
          <strong class="d-block d-sm-inline mt-1 mt-sm-0">"{{ materia.nombre }}"</strong>?
        </p>
        <div class="alert alert-warning mb-0 small">
          <i class="fas fa-exclamation-circle me-2"></i>
          Esta acción es <strong>irreversible</strong> y se perderán todos los datos asociados.
        </div>
      </div>
      <div class="modal-footer border-0 flex-column flex-sm-row gap-2">
        <button type="button" class="btn btn-secondary w-100 w-sm-auto order-2 order-sm-1" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i>Cancelar
        </button>
        <form method="post" class="w-100 w-sm-auto order-1 order-sm-2">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger w-100">
            <i class="fas fa-trash me-1"></i>Sí, Eliminar
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .breadcrumb a {
    text-decoration: none;
  }

  .breadcrumb a:hover {
    text-decoration: underline;
  }
</style>
{% endblock %}