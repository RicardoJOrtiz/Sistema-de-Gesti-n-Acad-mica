{% extends 'base.html' %}
{% load static %}

{% block title %}Contraseña Restablecida{% endblock %}

{% block extra_css %}
<style>
    .success-container {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
    }
    
    .success-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
        max-width: 500px;
        margin: 0 auto;
    }
    
    .success-header {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
        padding: 2rem;
        text-align: center;
    }
    
    .success-body {
        padding: 2rem;
    }
    
    .success-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        animation: bounceIn 1s ease-out;
    }
    
    @keyframes bounceIn {
        0% {
            transform: scale(0);
            opacity: 0;
        }
        50% {
            transform: scale(1.1);
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }
    
    .btn-login {
        background: linear-gradient(45deg, #28a745, #20c997);
        border: none;
        border-radius: 50px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
    }
    
    .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .countdown {
        font-weight: bold;
        color: #28a745;
        font-size: 1.2em;
    }
    
    .check-list {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1.5rem;
        margin: 1.5rem 0;
    }
    
    .check-item {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;
    }
    
    .check-item:last-child {
        margin-bottom: 0;
    }
    
    .check-icon {
        color: #28a745;
        margin-right: 0.75rem;
        font-size: 1.1em;
    }
    
    .pulse {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
        100% {
            transform: scale(1);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="success-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="success-card">
                    <div class="success-header">
                        <i class="fas fa-check-circle success-icon"></i>
                        <h2 class="fw-bold mb-2">¡Contraseña Restablecida!</h2>
                        <p class="mb-0 opacity-75">
                            Tu contraseña ha sido actualizada exitosamente
                        </p>
                    </div>
                    
                    <div class="success-body">
                        <!-- Mostrar mensajes -->
                        {% if messages %}
                            {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                            {% endfor %}
                        {% endif %}
                        
                        <div class="text-center mb-4">
                            <h5 class="text-success mb-3">
                                <i class="fas fa-shield-alt me-2"></i>
                                Tu cuenta está segura
                            </h5>
                            <p class="text-muted">
                                {% if usuario %}
                                    Hola {{ usuario.first_name }}, tu contraseña se ha actualizado correctamente. 
                                {% else %}
                                    Tu contraseña se ha actualizado correctamente.
                                {% endif %}
                                Ya puedes iniciar sesión con tu nueva contraseña.
                            </p>
                        </div>
                        
                        <div class="check-list">
                            <h6 class="fw-bold text-secondary mb-3">
                                <i class="fas fa-clipboard-check me-2"></i>
                                Proceso Completado
                            </h6>
                            <div class="check-item">
                                <i class="fas fa-check check-icon"></i>
                                <span>Token de seguridad validado</span>
                            </div>
                            <div class="check-item">
                                <i class="fas fa-check check-icon"></i>
                                <span>Nueva contraseña establecida</span>
                            </div>
                            <div class="check-item">
                                <i class="fas fa-check check-icon"></i>
                                <span>Cuenta actualizada y protegida</span>
                            </div>
                            <div class="check-item">
                                <i class="fas fa-check check-icon"></i>
                                <span>Listo para iniciar sesión</span>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 mb-3">
                            <a href="{% url 'usuarios:login' %}" class="btn btn-primary btn-login pulse" id="loginButton">
                                <i class="fas fa-sign-in-alt me-2"></i>
                                Iniciar Sesión Ahora
                            </a>
                        </div>
                        
                        <div class="text-center">
                            <p class="small text-muted mb-2">
                                Serás redirigido automáticamente en <span class="countdown" id="countdown">10</span> segundos
                            </p>
                            <button type="button" class="btn btn-outline-secondary btn-sm" id="cancelRedirect">
                                Cancelar redirección
                            </button>
                        </div>
                        
                        <div class="mt-4 p-3 bg-light rounded">
                            <h6 class="fw-bold text-secondary mb-2">
                                <i class="fas fa-lightbulb me-2"></i>
                                Recomendaciones de Seguridad
                            </h6>
                            <ul class="small text-muted mb-0">
                                <li>Mantén tu contraseña privada y segura</li>
                                <li>No compartas tu información de acceso</li>
                                <li>Cierra sesión al terminar de usar el sistema</li>
                                <li>Si no solicitaste este cambio, contacta al administrador</li>
                            </ul>
                        </div>
                        
                        {% if usuario and usuario.email %}
                        <div class="mt-3 p-3 bg-info bg-opacity-10 border border-info border-opacity-25 rounded">
                            <p class="small text-info mb-0">
                                <i class="fas fa-envelope me-2"></i>
                                Se ha enviado una confirmación a: <strong>{{ usuario.email|slice:":3" }}***@{{ usuario.email|slice:"3:" }}</strong>
                            </p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    let countdown = 10;
    let redirectTimer;
    let isRedirectCancelled = false;
    
    const countdownElement = document.getElementById('countdown');
    const cancelButton = document.getElementById('cancelRedirect');
    const loginButton = document.getElementById('loginButton');
    
    function updateCountdown() {
        if (!isRedirectCancelled) {
            countdownElement.textContent = countdown;
            
            if (countdown <= 0) {
                clearInterval(redirectTimer);
                // Redirect to login page
                window.location.href = "{% url 'usuarios:login' %}";
            }
            countdown--;
        }
    }
    
    // Start countdown
    redirectTimer = setInterval(updateCountdown, 1000);
    
    // Cancel redirect
    cancelButton.addEventListener('click', function() {
        isRedirectCancelled = true;
        clearInterval(redirectTimer);
        countdownElement.textContent = '∞';
        this.textContent = 'Redirección cancelada';
        this.disabled = true;
        this.classList.remove('btn-outline-secondary');
        this.classList.add('btn-outline-success');
        
        // Remove pulse animation from login button
        loginButton.classList.remove('pulse');
    });
    
    // Manual login button click
    loginButton.addEventListener('click', function() {
        clearInterval(redirectTimer);
    });
    
    // Show success animation
    setTimeout(function() {
        const successIcon = document.querySelector('.success-icon');
        if (successIcon) {
            successIcon.style.transform = 'scale(1.2)';
            setTimeout(function() {
                successIcon.style.transform = 'scale(1)';
            }, 200);
        }
    }, 500);
    
    // Add focus to login button after animation
    setTimeout(function() {
        loginButton.focus();
    }, 1500);
});

// Prevent back button to password reset form
window.addEventListener('pageshow', function(event) {
    if (event.persisted || (window.performance && window.performance.navigation.type == 2)) {
        // Redirect to login if user tries to go back
        window.location.href = "{% url 'usuarios:login' %}";
    }
});
</script>
{% endblock %}